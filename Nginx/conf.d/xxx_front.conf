#cat 88xxxx_front.conf
# === http {} 顶层：用 Accept 头识别“页面请求”（仅 GET + text/html 才兜底）===
map $http_accept $is_html {
    default        0;
    "~*text/html"  1;
}

upstream 88xxxx_sport_admin {
        server 172.36.1.54:8813 max_fails=1 fail_timeout=15;
    server 172.36.1.108:8814 max_fails=1 fail_timeout=15;

}


server {
  server_name _;
                listen 10033;
                 add_header X-Frame-Options "ALLOWALL" always;
        location / {
                try_files $uri $uri/ /index.html;
                        root /usr/share/nginx/88xxxx_web/;
                }
        location /notice {
                        proxy_pass http://88xxxx_sport_admin/notice;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
        }
                location /front {
                        proxy_pass http://88xxxx_sport_admin/front;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
        }
                access_log  /var/log/nginx/10033-web-access.log  main;
} 


server {
  server_name _;
                listen 10034;
                 add_header X-Frame-Options "ALLOWALL" always;
                # 避免 Nginx 自生成重定向里带端口
                port_in_redirect off;
                server_name_in_redirect off;

                #location / {
                #           try_files $uri $uri/ /index.html;
                #}
           # 静态资源：必须真实存在，不存在就 404（避免被 index.html 吞掉）
                location ~* \.(?:html|js|mjs|css|map|png|jpe?g|gif|svg|ico|webp|avif|woff2?|ttf|eot)$ {
                try_files $uri =404;
                access_log off;
                expires 7d;
                }
                 # 主页文件本身
                location = /index.html {
                try_files /index.html =404;
                add_header Cache-Control "no-store";
                }

                # 其余路径：先找文件/目录；失败时仅对“像页面的 GET 请求”兜底到 index.html
                location / {
                try_files $uri $uri/ @spa;
                }
                location @spa {
                if ($request_method != GET) { return 404; }
                if ($is_html = 0)           { return 404; }
                try_files /index.html =404;
                }
         
                root /usr/share/nginx/88xxxx_h5/;
                index index.html;
                location /notice {
                        proxy_pass http://88xxxx_sport_admin/notice;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
        }
                location /front {
                        proxy_pass http://88xxxx_sport_admin/front;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
        }
                access_log  /var/log/nginx/10034-web-access.log  main;
} 


##后台
server {
                 server_name _;
                 listen 10035;
                 location / {
                        #access_by_lua_file /etc/nginx/lua/aes.lua;
                        proxy_pass http://88xxxx_sport_admin/;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
                }
                access_log  /var/log/nginx/10035-access.log  main;
        } 

##pwa
server {
                server_name _;
                listen 10046;
                
                # 避免 Nginx 自生成重定向里带端口
                port_in_redirect off;
                server_name_in_redirect off;
                root /usr/share/nginx/88xxxx_pwa/;
                index index.html;

                #location / {
                #           try_files $uri $uri/ /index.html;
                #}
           # 静态资源：必须真实存在，不存在就 404（避免被 index.html 吞掉）
                location ~* \.(?:html|js|mjs|css|map|png|jpe?g|gif|svg|ico|webp|avif|woff2?|ttf|eot)$ {
                try_files $uri =404;
                access_log off;
                expires 7d;
                }
                 # 主页文件本身
                location = /index.html {
                try_files /index.html =404;
                add_header Cache-Control "no-store";
                }

                # 其余路径：先找文件/目录；失败时仅对“像页面的 GET 请求”兜底到 index.html
                location / {
                try_files $uri $uri/ @spa;
                }
                location @spa {
                if ($request_method != GET) { return 404; }
                if ($is_html = 0)           { return 404; }
                try_files /index.html =404;
                }

                location /notice {
                        proxy_pass http://88xxxx_sport_admin/notice;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
           }

           location /front {
                        proxy_pass http://88xxxx_sport_admin/front;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
           }

                access_log  /var/log/nginx/pwa/88xxxx-pwa-web-access.log;
}

server {
           server_name _;
           listen 10047;

           location / {
                   return 403;
           }

           location /notice {
                        proxy_pass http://88xxxx_sport_admin/notice;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
           }

           location /front {
                        proxy_pass http://88xxxx_sport_admin/front;
                        proxy_set_header X-Forwarded-Proto $scheme;
                        proxy_set_header Host $http_host;
           }

           access_log  /var/log/nginx/pwa/88xxxx-pwa-api-access.log;

}
